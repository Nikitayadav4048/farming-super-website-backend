<!DOCTYPE html>
<html>
<head>
    <title>OAuth - Farming Website</title>
    <style>
        body { font-family: Arial, sans-serif; max-width: 400px; margin: 50px auto; padding: 20px; }
        .form-group { margin-bottom: 15px; }
        input { width: 100%; padding: 10px; border: 1px solid #ddd; border-radius: 4px; }
        button, a { width: 100%; padding: 12px; background: #007bff; color: white; border: none; border-radius: 4px; cursor: pointer; margin-bottom: 10px; text-decoration: none; display: block; text-align: center; }
        button:hover, a:hover { background: #0056b3; }
        .google-btn { background: #db4437; }
        .google-btn:hover { background: #c23321; }
        .result { margin-top: 20px; padding: 10px; border-radius: 4px; }
        .success { background: #d4edda; color: #155724; border: 1px solid #c3e6cb; }
        .error { background: #f8d7da; color: #721c24; border: 1px solid #f5c6cb; }
    </style>
</head>
<body>
    <h1>Farming Website Login</h1>
    
    <!-- Google Sign-In -->
    <a id="googleSignIn" class="google-btn">üîç Sign in with Google</a>
    
    <hr style="margin: 30px 0;">
    
    <div id="registerForm">
        <h2>Register</h2>
        <form id="register">
            <div class="form-group"><input type="text" placeholder="Full Name" required></div>
            <div class="form-group"><input type="email" placeholder="Email" required></div>
            <div class="form-group"><input type="password" placeholder="Password" required></div>
            <button type="submit">Register</button>
        </form>
    </div>
    
    <hr style="margin: 30px 0;">
    
    <div id="loginForm">
        <h2>Login</h2>
        <form id="login">
            <div class="form-group"><input type="email" placeholder="Email" required></div>
            <div class="form-group"><input type="password" placeholder="Password" required></div>
            <button type="submit">Login</button>
        </form>
    </div>
    
    <div id="result"></div>

    <script>
        // Dynamically detect backend URL
        const BACKEND_BASE_URL = window.location.hostname.includes('localhost')
            ? 'http://localhost:3000' // local backend
            : 'https://farming-super-website-backend.onrender.com'; // deployed backend

        // Set Google Sign-In link dynamically
        document.getElementById('googleSignIn').href = `${BACKEND_BASE_URL}/api/auth/google`;

        // Check for OAuth success/error
        const urlParams = new URLSearchParams(window.location.search);
        const token = urlParams.get('token');
        const user = urlParams.get('user');
        const error = urlParams.get('error');
        
        if (token && user) {
            const userData = JSON.parse(decodeURIComponent(user));
            document.getElementById('result').innerHTML = 
                `<div class="result success">
                    <h3>‚úÖ Google Login Success!</h3>
                    <p>Name: ${userData.name}</p>
                    <p>Email: ${userData.email}</p>
                    <p>Token: ${token.substring(0, 20)}...</p>
                </div>`;
        } else if (error === 'oauth_failed') {
            document.getElementById('result').innerHTML = 
                `<div class="result error">
                    <h3>‚ùå Google Login Failed</h3>
                    <p>OAuth authentication failed. Please try again.</p>
                </div>`;
        }

        // Register form
        document.getElementById('register').onsubmit = function(e) {
            e.preventDefault();
            const name = e.target[0].value;
            const email = e.target[1].value;
            const password = e.target[2].value;

            fetch(`${BACKEND_BASE_URL}/api/auth/register`, {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({ name, email, password, role: 'user' })
            })
            .then(res => res.json())
            .then(data => {
                if (data.token) {
                    document.getElementById('result').innerHTML = 
                        `<div class="result success">
                            <h3>‚úÖ Registration Success!</h3>
                            <p>Name: ${data.user.name}</p>
                            <p>Email: ${data.user.email}</p>
                        </div>`;
                } else {
                    throw new Error(data.error);
                }
            })
            .catch(err => {
                document.getElementById('result').innerHTML = 
                    `<div class="result error">
                        <h3>‚ùå Registration Failed</h3>
                        <p>${err.message}</p>
                    </div>`;
            });
        };
        
        // Login form
        document.getElementById('login').onsubmit = function(e) {
            e.preventDefault();
            const email = e.target[0].value;
            const password = e.target[1].value;

            fetch(`${BACKEND_BASE_URL}/api/auth/login`, {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({ email, password })
            })
            .then(res => res.json())
            .then(data => {
                if (data.token) {
                    document.getElementById('result').innerHTML = 
                        `<div class="result success">
                            <h3>‚úÖ Login Success!</h3>
                            <p>Name: ${data.user.name}</p>
                            <p>Email: ${data.user.email}</p>
                        </div>`;
                } else {
                    throw new Error(data.error);
                }
            })
            .catch(err => {
                document.getElementById('result').innerHTML = 
                    `<div class="result error">
                        <h3>‚ùå Login Failed</h3>
                        <p>${err.message}</p>
                    </div>`;
            });
        };
    </script>
</body>
</html>

<!DOCTYPE html>
<html>
<head>
    <title>OAuth - Farming Website</title>
    <style>
        body { font-family: Arial, sans-serif; max-width: 400px; margin: 50px auto; padding: 20px; }
        .form-group { margin-bottom: 15px; }
        input { width: 100%; padding: 10px; border: 1px solid #ddd; border-radius: 4px; }
        button, a { width: 100%; padding: 12px; background: #007bff; color: white; border: none; border-radius: 4px; cursor: pointer; margin-bottom: 10px; text-decoration: none; display: block; text-align: center; }
        button:hover, a:hover { background: #0056b3; }
        .google-btn { background: #db4437; }
        .google-btn:hover { background: #c23321; }
        .result { margin-top: 20px; padding: 10px; border-radius: 4px; }
        .success { background: #d4edda; color: #155724; border: 1px solid #c3e6cb; }
        .error { background: #f8d7da; color: #721c24; border: 1px solid #f5c6cb; }
    </style>
</head>
<body>
    <h1>Farming Website Login</h1>
    
    <!-- Google Sign-In -->
    <a href="http://localhost:3000/api/auth/google" class="google-btn">üîç Sign in with Google</a>
    
    <hr style="margin: 30px 0;">
    
    <div id="registerForm">
        <h2>Register</h2>
        <form id="register">
            <div class="form-group">
                <input type="text" placeholder="Full Name" required>
            </div>
            <div class="form-group">
                <input type="email" placeholder="Email" required>
            </div>
            <div class="form-group">
                <input type="password" placeholder="Password" required>
            </div>
            <button type="submit">Register</button>
        </form>
    </div>
    
    <hr style="margin: 30px 0;">
    
    <div id="loginForm">
        <h2>Login</h2>
        <form id="login">
            <div class="form-group">
                <input type="email" placeholder="Email" required>
            </div>
            <div class="form-group">
                <input type="password" placeholder="Password" required>
            </div>
            <button type="submit">Login</button>
        </form>
    </div>
    
    <div id="result"></div>

    <script>
        // Check for OAuth success/error
        const urlParams = new URLSearchParams(window.location.search);
        const token = urlParams.get('token');
        const user = urlParams.get('user');
        const error = urlParams.get('error');
        
        if (token && user) {
            const userData = JSON.parse(decodeURIComponent(user));
            document.getElementById('result').innerHTML = 
                `<div class="result success">
                    <h3>‚úÖ Google Login Success!</h3>
                    <p>Name: ${userData.name}</p>
                    <p>Email: ${userData.email}</p>
                    <p>Token: ${token.substring(0, 20)}...</p>
                </div>`;
        } else if (error === 'oauth_failed') {
            document.getElementById('result').innerHTML = 
                `<div class="result error">
                    <h3>‚ùå Google Login Failed</h3>
                    <p>OAuth authentication failed. Please try again.</p>
                </div>`;
        }

        // Register
        document.getElementById('register').onsubmit = function(e) {
            e.preventDefault();
            const name = e.target[0].value;
            const email = e.target[1].value;
            const password = e.target[2].value;
            
            fetch('http://localhost:3000/api/auth/register', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({ name, email, password, role: 'user' })
            })
            .then(res => res.json())
            .then(data => {
                if (data.token) {
                    document.getElementById('result').innerHTML = 
                        `<div class="result success">
                            <h3>‚úÖ Registration Success!</h3>
                            <p>Name: ${data.user.name}</p>
                            <p>Email: ${data.user.email}</p>
                        </div>`;
                } else {
                    throw new Error(data.error);
                }
            })
            .catch(err => {
                document.getElementById('result').innerHTML = 
                    `<div class="result error">
                        <h3>‚ùå Registration Failed</h3>
                        <p>${err.message}</p>
                    </div>`;
            });
        };
        
        // Login
        document.getElementById('login').onsubmit = function(e) {
            e.preventDefault();
            const email = e.target[0].value;
            const password = e.target[1].value;
            
            fetch('http://localhost:3000/api/auth/login', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({ email, password })
            })
            .then(res => res.json())
            .then(data => {
                if (data.token) {
                    document.getElementById('result').innerHTML = 
                        `<div class="result success">
                            <h3>‚úÖ Login Success!</h3>
                            <p>Name: ${data.user.name}</p>
                            <p>Email: ${data.user.email}</p>
                        </div>`;
                } else {
                    throw new Error(data.error);
                }
            })
            .catch(err => {
                document.getElementById('result').innerHTML = 
                    `<div class="result error">
                        <h3>‚ùå Login Failed</h3>
                        <p>${err.message}</p>
                    </div>`;
            });
        };
    </script>
</body>
</html>